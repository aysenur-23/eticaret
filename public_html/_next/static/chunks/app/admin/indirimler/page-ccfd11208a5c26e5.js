(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9752],{310:function(e,a,t){Promise.resolve().then(t.bind(t,7297))},7297:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return D}});var s=t(7437),l=t(2265),i=t(9376),n=t(6070),r=t(2869),c=t(5186),d=t(6815),o=t(6110),m=t(3647),x=t(5974),h=t(9397),u=t(5863),p=t(5675),j=t(8930),v=t(9412),N=t(4712);let y={ALL:"T\xfcm \xfcr\xfcnler",CATEGORY:"Kategori bazlı",PRODUCT:"\xdcr\xfcn bazlı"},g=v.ws.flatMap(e=>e.categoryValues);function D(){var e,a,v;let D=(0,i.useRouter)(),[b,f]=(0,l.useState)([]),[w,C]=(0,l.useState)(!0),[T,k]=(0,l.useState)(!1),[I,P]=(0,l.useState)(null),[A,E]=(0,l.useState)(!1),[R,O]=(0,l.useState)(null),[S,z]=(0,l.useState)({name:"",scope:"ALL",categoryName:"",productIds:[],type:"PERCENT",value:10,startDate:"",endDate:"",active:!0}),L=async()=>{if(!localStorage.getItem("admin_uid")){D.push("/admin/auth"),C(!1);return}try{let{collection:e,getDocs:a}=await Promise.all([t.e(4358),t.e(9697),t.e(6370)]).then(t.bind(t,5978)),{getDb:s}=await Promise.all([t.e(4358),t.e(139),t.e(9697),t.e(6370),t.e(6565),t.e(4257)]).then(t.bind(t,4257)),l=s(),i=(await a(e(l,"discounts"))).docs.map(e=>{var a,t,s,l,i;let n=e.data(),r=n.createdAt,c=n.updatedAt;return{id:e.id,name:n.name||"",scope:n.scope||"ALL",categoryName:null!==(a=n.categoryName)&&void 0!==a?a:null,productIds:null!==(t=n.productIds)&&void 0!==t?t:null,type:n.type||"PERCENT",value:n.value||0,startDate:null!==(s=n.startDate)&&void 0!==s?s:null,endDate:null!==(l=n.endDate)&&void 0!==l?l:null,active:null===(i=n.active)||void 0===i||i,createdAt:(null==r?void 0:r.seconds)?new Date(1e3*r.seconds).toISOString():"",updatedAt:(null==c?void 0:c.seconds)?new Date(1e3*c.seconds).toISOString():""}});f(i)}catch(e){f([])}finally{C(!1)}};(0,l.useEffect)(()=>{L()},[D]);let _=e=>{var a;P(e.id),z({name:e.name,scope:e.scope,categoryName:null!==(a=e.categoryName)&&void 0!==a?a:"",productIds:Array.isArray(e.productIds)?e.productIds:[],type:e.type,value:e.value,startDate:e.startDate?e.startDate.slice(0,16):"",endDate:e.endDate?e.endDate.slice(0,16):"",active:e.active}),k(!0)},Y=async e=>{e.preventDefault(),E(!0);try{let{doc:e,setDoc:a,addDoc:s,collection:l,serverTimestamp:i}=await Promise.all([t.e(4358),t.e(9697),t.e(6370)]).then(t.bind(t,5978)),{getDb:n}=await Promise.all([t.e(4358),t.e(139),t.e(9697),t.e(6370),t.e(6565),t.e(4257)]).then(t.bind(t,4257)),r=n(),c={name:S.name.trim(),scope:S.scope,categoryName:"CATEGORY"===S.scope&&S.categoryName||null,productIds:"PRODUCT"===S.scope?S.productIds:null,type:S.type,value:Number(S.value),startDate:S.startDate?new Date(S.startDate).toISOString():null,endDate:S.endDate?new Date(S.endDate).toISOString():null,active:S.active,updatedAt:i()};I?await a(e(r,"discounts",I),c,{merge:!0}):await s(l(r,"discounts"),{...c,createdAt:i()}),k(!1),L()}finally{E(!1)}},K=async e=>{if(confirm("Bu indirimi silmek istediğinize emin misiniz?")){O(e);try{let{doc:a,deleteDoc:s}=await Promise.all([t.e(4358),t.e(9697),t.e(6370)]).then(t.bind(t,5978)),{getDb:l}=await Promise.all([t.e(4358),t.e(139),t.e(9697),t.e(6370),t.e(6565),t.e(4257)]).then(t.bind(t,4257)),i=l();await s(a(i,"discounts",e)),L()}finally{O(null)}}},Z=e=>{z(a=>({...a,productIds:a.productIds.includes(e)?a.productIds.filter(a=>a!==e):[...a.productIds,e]}))};return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"İndirimler"}),(0,s.jsx)("p",{className:"text-slate-600 mt-1",children:"Kampanya indirimlerini tanımlayın (t\xfcm \xfcr\xfcnler, kategori veya \xfcr\xfcn bazlı)"})]}),(0,s.jsxs)(r.z,{onClick:()=>{P(null),z({name:"",scope:"ALL",categoryName:"",productIds:[],type:"PERCENT",value:10,startDate:"",endDate:"",active:!0}),k(!0)},className:"shrink-0",children:[(0,s.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"Yeni indirim"]})]}),(0,s.jsxs)(n.Zb,{className:"border-slate-200/80 bg-white shadow-sm",children:[(0,s.jsx)(n.Ol,{children:(0,s.jsx)(n.ll,{className:"text-lg",children:"Tanımlı indirimler"})}),(0,s.jsx)(n.aY,{children:w?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)(u.Z,{className:"w-8 h-8 animate-spin text-slate-400"})}):0===b.length?(0,s.jsx)("p",{className:"text-slate-500 py-8 text-center",children:"Hen\xfcz indirim tanımlanmamış."}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,s.jsx)("th",{className:"text-left py-3 px-2 font-medium text-slate-700",children:"Ad"}),(0,s.jsx)("th",{className:"text-left py-3 px-2 font-medium text-slate-700",children:"Kapsam"}),(0,s.jsx)("th",{className:"text-left py-3 px-2 font-medium text-slate-700",children:"İndirim"}),(0,s.jsx)("th",{className:"text-left py-3 px-2 font-medium text-slate-700",children:"Tarih"}),(0,s.jsx)("th",{className:"text-left py-3 px-2 font-medium text-slate-700",children:"Durum"}),(0,s.jsx)("th",{className:"text-right py-3 px-2 font-medium text-slate-700",children:"İşlem"})]})}),(0,s.jsx)("tbody",{children:b.map(e=>{var a;return(0,s.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[(0,s.jsx)("td",{className:"py-3 px-2",children:e.name}),(0,s.jsxs)("td",{className:"py-3 px-2",children:[null!==(a=y[e.scope])&&void 0!==a?a:e.scope,"CATEGORY"===e.scope&&e.categoryName&&(0,s.jsx)("span",{className:"block text-xs text-slate-500 truncate max-w-[180px]",title:e.categoryName,children:e.categoryName}),"PRODUCT"===e.scope&&Array.isArray(e.productIds)&&(0,s.jsxs)("span",{className:"block text-xs text-slate-500",children:[e.productIds.length," \xfcr\xfcn"]})]}),(0,s.jsx)("td",{className:"py-3 px-2",children:"PERCENT"===e.type?"%".concat(e.value):"".concat(e.value," TL")}),(0,s.jsx)("td",{className:"py-3 px-2 text-slate-600",children:e.startDate||e.endDate?"".concat(e.startDate?new Date(e.startDate).toLocaleDateString("tr-TR"):"–"," / ").concat(e.endDate?new Date(e.endDate).toLocaleDateString("tr-TR"):"–"):"–"}),(0,s.jsx)("td",{className:"py-3 px-2",children:e.active?(0,s.jsx)(x.C,{className:"bg-green-100 text-green-800 border-0",children:"Aktif"}):(0,s.jsx)(x.C,{variant:"secondary",children:"Pasif"})}),(0,s.jsxs)("td",{className:"py-3 px-2 text-right",children:[(0,s.jsx)(r.z,{variant:"ghost",size:"icon",onClick:()=>_(e),className:"h-8 w-8",children:(0,s.jsx)(p.Z,{className:"w-4 h-4"})}),(0,s.jsx)(r.z,{variant:"ghost",size:"icon",onClick:()=>K(e.id),disabled:R===e.id,className:"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50",children:R===e.id?(0,s.jsx)(u.Z,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(j.Z,{className:"w-4 h-4"})})]})]},e.id)})})]})})})]}),(0,s.jsx)(o.Vq,{open:T,onOpenChange:k,children:(0,s.jsxs)(o.cZ,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(o.fK,{children:[(0,s.jsx)(o.$N,{children:I?"İndirimi d\xfczenle":"Yeni indirim"}),(0,s.jsx)(o.Be,{children:"Kapsam, tip ve değer girin. Tarih boş bırakılırsa s\xfcresiz ge\xe7erli olur."})]}),(0,s.jsxs)("form",{onSubmit:Y,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"name",children:"Kampanya adı"}),(0,s.jsx)(c.I,{id:"name",value:S.name,onChange:e=>z(a=>({...a,name:e.target.value})),placeholder:"\xd6rn. Yaz İndirimi",required:!0,className:"mt-1"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{children:"Kapsam"}),(0,s.jsxs)(m.Ph,{value:null!==(e=S.scope)&&void 0!==e?e:"",onValueChange:e=>z(a=>({...a,scope:e})),children:[(0,s.jsx)(m.i4,{className:"mt-1",children:(0,s.jsx)(m.ki,{})}),(0,s.jsxs)(m.Bw,{children:[(0,s.jsx)(m.Ql,{value:"ALL",children:y.ALL}),(0,s.jsx)(m.Ql,{value:"CATEGORY",children:y.CATEGORY}),(0,s.jsx)(m.Ql,{value:"PRODUCT",children:y.PRODUCT})]})]})]}),"CATEGORY"===S.scope&&(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{children:"Kategori"}),(0,s.jsxs)(m.Ph,{value:null!==(a=S.categoryName)&&void 0!==a?a:"",onValueChange:e=>z(a=>({...a,categoryName:e})),children:[(0,s.jsx)(m.i4,{className:"mt-1",children:(0,s.jsx)(m.ki,{placeholder:"Kategori se\xe7in"})}),(0,s.jsx)(m.Bw,{children:g.map(e=>(0,s.jsx)(m.Ql,{value:e,children:e},e))})]})]}),"PRODUCT"===S.scope&&(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{children:"\xdcr\xfcnler (\xe7oklu se\xe7im)"}),(0,s.jsxs)("div",{className:"mt-1 border rounded-lg p-3 max-h-48 overflow-y-auto space-y-2 bg-slate-50",children:[N.mockProducts.slice(0,200).map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:S.productIds.includes(e.id),onChange:()=>Z(e.id),className:"rounded border-slate-300"}),(0,s.jsx)("span",{className:"text-sm truncate",children:e.name})]},e.id)),N.mockProducts.length>200&&(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"İlk 200 \xfcr\xfcn listeleniyor. Daha fazlası i\xe7in arama eklenebilir."})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{children:"Tip"}),(0,s.jsxs)(m.Ph,{value:null!==(v=S.type)&&void 0!==v?v:"",onValueChange:e=>z(a=>({...a,type:e})),children:[(0,s.jsx)(m.i4,{className:"mt-1",children:(0,s.jsx)(m.ki,{})}),(0,s.jsxs)(m.Bw,{children:[(0,s.jsx)(m.Ql,{value:"PERCENT",children:"Y\xfczde"}),(0,s.jsx)(m.Ql,{value:"FIXED",children:"Sabit (TL)"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"value",children:"PERCENT"===S.type?"Y\xfczde (%)":"Tutar (TL)"}),(0,s.jsx)(c.I,{id:"value",type:"number",min:0,step:"PERCENT"===S.type?1:.01,value:S.value,onChange:e=>z(a=>({...a,value:Number(e.target.value)||0})),className:"mt-1"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"startDate",children:"Başlangı\xe7 (opsiyonel)"}),(0,s.jsx)(c.I,{id:"startDate",type:"datetime-local",value:S.startDate,onChange:e=>z(a=>({...a,startDate:e.target.value})),className:"mt-1"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d._,{htmlFor:"endDate",children:"Bitiş (opsiyonel)"}),(0,s.jsx)(c.I,{id:"endDate",type:"datetime-local",value:S.endDate,onChange:e=>z(a=>({...a,endDate:e.target.value})),className:"mt-1"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"active",checked:S.active,onChange:e=>z(a=>({...a,active:e.target.checked})),className:"rounded border-slate-300"}),(0,s.jsx)(d._,{htmlFor:"active",children:"Aktif"})]}),(0,s.jsxs)(o.cN,{children:[(0,s.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>k(!1),children:"İptal"}),(0,s.jsxs)(r.z,{type:"submit",disabled:A,children:[A?(0,s.jsx)(u.Z,{className:"w-4 h-4 animate-spin mr-2"}):null,I?"G\xfcncelle":"Oluştur"]})]})]})]})})]})}}},function(e){e.O(0,[8743,2249,3347,4116,6324,9766,481,4712,7466,2971,2117,1744],function(){return e(e.s=310)}),_N_E=e.O()}]);