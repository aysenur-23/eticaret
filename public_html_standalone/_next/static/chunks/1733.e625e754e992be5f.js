"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1733],{1733:function(t,e,a){a.d(e,{useCartStore:function(){return l}});var r=a(4660),o=a(4810);function i(){try{var t;let e=localStorage.getItem("auth-storage");if(!e)return!1;let a=JSON.parse(e);return(null==a?void 0:null===(t=a.state)||void 0===t?void 0:t.isAuthenticated)===!0}catch(t){return!1}}let l=(0,r.Ue)()((0,o.tJ)((t,e)=>({items:[],isLoading:!1,addItem:async a=>{try{let o=e().items.find(t=>t.id===a.id);if(o?e().updateQuantity(a.id,o.quantity+1):t(t=>({items:[...t.items,{...a,quantity:1}]})),i()){let t=localStorage.getItem("auth-storage");if(t)try{var r;let a=JSON.parse(t),o=null==a?void 0:null===(r=a.state)||void 0===r?void 0:r.token;o&&await e().syncCartToServer(o)}catch(t){}}}catch(t){throw console.error("addItem hatası:",t),t}},removeItem:async a=>{if(t(t=>({items:t.items.filter(t=>t.id!==a)})),i()){let t=localStorage.getItem("auth-storage");if(t)try{var r;let a=JSON.parse(t),o=null==a?void 0:null===(r=a.state)||void 0===r?void 0:r.token;o&&await e().syncCartToServer(o)}catch(t){}}},updateQuantity:async(a,r)=>{if(r<=0){e().removeItem(a);return}if(t(t=>({items:t.items.map(t=>t.id===a?{...t,quantity:r}:t)})),i()){let t=localStorage.getItem("auth-storage");if(t)try{var o;let a=JSON.parse(t),r=null==a?void 0:null===(o=a.state)||void 0===o?void 0:o.token;r&&await e().syncCartToServer(r)}catch(t){}}},clearCart:()=>{t({items:[]})},getTotalPrice:()=>e().items.reduce((t,e)=>t+e.price*e.quantity,0),getTotalItems:()=>e().items.reduce((t,e)=>t+e.quantity,0),getItemQuantity:t=>{let a=e().items.find(e=>e.id===t);return a?a.quantity:0},loadCartFromServer:async e=>{try{t({isLoading:!0});let a=await fetch("/api/cart",{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){let e=await a.json();t({items:e.items||[]})}else 401===a.status&&t({items:[]})}catch(t){console.error("Sepet y\xfckleme hatası:",t)}finally{t({isLoading:!1})}},syncCartToServer:async t=>{try{let a=e().items;await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({items:a})})}catch(t){console.error("Sepet senkronizasyon hatası:",t)}}}),{name:"cart-storage",storage:{getItem:t=>{if(!i())return localStorage.removeItem(t),null;let e=localStorage.getItem(t);if(!e)return null;try{var a;let r=JSON.parse(e),o=Date.now();if((null==r?void 0:r.expire)&&o>r.expire)return localStorage.removeItem(t),null;if((null==r?void 0:null===(a=r.state)||void 0===a?void 0:a.items)&&Array.isArray(r.state.items)&&0===r.state.items.length)return null;if(null==r?void 0:r.state)return JSON.stringify({state:r.state,version:r.version||0});return e}catch(e){return localStorage.removeItem(t),null}},setItem:(t,e)=>{try{let a;let r="string"==typeof e?e:JSON.stringify(e),o=JSON.parse(r);i()&&(a=Date.now()+5184e6);let l={...o,...a&&{expire:a}};localStorage.setItem(t,JSON.stringify(l))}catch(r){let a="string"==typeof e?e:JSON.stringify(e);localStorage.setItem(t,a)}},removeItem:t=>{localStorage.removeItem(t)}}}));{window.addEventListener("beforeunload",()=>{i()||localStorage.removeItem("cart-storage")});let t=()=>{if(i())try{let e=localStorage.getItem("auth-storage");if(e){var t;let a=JSON.parse(e),r=null==a?void 0:null===(t=a.state)||void 0===t?void 0:t.token;r&&l.getState().loadCartFromServer(r)}}catch(t){}else localStorage.removeItem("cart-storage"),l.getState().clearCart()};"complete"===document.readyState?t():(window.addEventListener("load",t),"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",t))}}}]);