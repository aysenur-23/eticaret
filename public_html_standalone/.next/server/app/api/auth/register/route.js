"use strict";(()=>{var e={};e.id=3002,e.ids=[3002],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},17252:e=>{e.exports=require("prettier/plugins/html")},87413:e=>{e.exports=require("prettier/standalone")},50852:e=>{e.exports=require("async_hooks")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},84492:e=>{e.exports=require("node:stream")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},13436:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>V,originalPathname:()=>K,patchFetch:()=>L,requestAsyncStorage:()=>F,routeModule:()=>H,serverHooks:()=>O,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>$});var s={};t.r(s),t.d(s,{POST:()=>U});var a=t(95419),i=t(69108),o=t(99678),n=t(78070),l=t(3214),u=t(7529),c=t(46082),p=t.n(c),d=t(6113),m=t.n(d),x=t(39145),g=t(25036);t(40002);var h=t(87165),f=t(56434),y=t(66802),S=t(3948),k=t(71601),T=t(80029),P=t(86543),b=t(1568);let v={backgroundColor:"#f6f9fc",fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif'},j={backgroundColor:"#ffffff",margin:"0 auto",padding:"20px 0 48px",marginBottom:"64px"},E={padding:"32px 24px",backgroundColor:"#2563eb",textAlign:"center"},M={color:"#ffffff",fontSize:"24px",fontWeight:"bold",margin:"0"},q={padding:"0 48px"},w={fontSize:"24px",lineHeight:"1.3",fontWeight:"700",color:"#1a202c",margin:"32px 0 24px"},z={color:"#4a5568",fontSize:"16px",lineHeight:"26px",margin:"16px 0"},_={textAlign:"center",margin:"32px 0"},D={backgroundColor:"#2563eb",borderRadius:"6px",color:"#fff",fontSize:"16px",fontWeight:"600",textDecoration:"none",textAlign:"center",display:"inline-block",padding:"12px 32px"},R={backgroundColor:"#f7fafc",borderRadius:"6px",padding:"16px",textAlign:"center",margin:"24px 0"},A={fontSize:"32px",fontWeight:"bold",letterSpacing:"8px",color:"#2563eb",margin:"0",fontFamily:"monospace"},C={borderColor:"#e2e8f0",margin:"32px 0"},B={color:"#718096",fontSize:"12px",lineHeight:"16px",margin:"8px 0",textAlign:"center"};async function U(e){try{let{email:r,password:t,name:s,phone:a}=await e.json();if(!r||!t||!s)return n.Z.json({success:!1,error:"E-posta, şifre ve ad soyad gereklidir"},{status:400});if(t.length<6)return n.Z.json({success:!1,error:"Şifre en az 6 karakter olmalıdır"},{status:400});if(await l._.user.findUnique({where:{email:r.toLowerCase()}}))return n.Z.json({success:!1,error:"Bu e-posta adresi zaten kullanılıyor"},{status:400});let i=await u.ZP.hash(t,10),o=m().randomBytes(32).toString("hex"),c=new Date;c.setHours(c.getHours()+24);let d=await l._.user.create({data:{email:r.toLowerCase(),password:i,name:s,phone:a,role:"customer",emailVerified:!1,emailVerificationToken:o,emailVerificationExpires:c}}),U=o.slice(-6).toUpperCase(),H=`http://localhost:3000/api/auth/verify-email?token=${o}`;try{await (0,x.KX)(d.email,"E-posta Adresinizi Doğrulayın - Batarya Kit",function({name:e,verificationUrl:r,verificationCode:t}){return(0,g.jsxs)(h.V,{children:[g.jsx(f.F,{}),g.jsx(y.u,{style:v,children:(0,g.jsxs)(S.W,{style:j,children:[g.jsx(k.$,{style:E,children:g.jsx(T.x,{style:M,children:"\uD83D\uDD0B Batarya Kit"})}),(0,g.jsxs)(k.$,{style:q,children:[g.jsx(T.x,{style:w,children:"E-posta Adresinizi Doğrulayın"}),(0,g.jsxs)(T.x,{style:z,children:["Merhaba ",g.jsx("strong",{children:e}),","]}),g.jsx(T.x,{style:z,children:"Batarya Kit'e hoş geldiniz! Hesabınızı aktifleştirmek i\xe7in e-posta adresinizi doğrulamanız gerekiyor."}),g.jsx(k.$,{style:_,children:g.jsx(P.z,{style:D,href:r,children:"E-postayı Doğrula"})}),t&&(0,g.jsxs)(g.Fragment,{children:[g.jsx(T.x,{style:z,children:"Veya aşağıdaki doğrulama kodunu kullanabilirsiniz:"}),g.jsx(k.$,{style:R,children:g.jsx(T.x,{style:A,children:t})})]}),g.jsx(T.x,{style:z,children:"Bu link 24 saat ge\xe7erlidir. Eğer bu işlemi siz yapmadıysanız, bu e-postayı g\xf6rmezden gelebilirsiniz."}),g.jsx(b.Hr,{style:C}),g.jsx(T.x,{style:B,children:"Bu e-posta otomatik olarak g\xf6nderilmiştir. L\xfctfen yanıtlamayın."}),(0,g.jsxs)(T.x,{style:B,children:["\xa9 ",new Date().getFullYear()," Batarya Kit. T\xfcm hakları saklıdır."]})]})]})})]})}({name:d.name,verificationUrl:H,verificationCode:U}))}catch(e){console.error("Email g\xf6nderme hatası:",e)}let F=p().sign({userId:d.id,email:d.email,role:d.role,emailVerified:!1},process.env.JWT_SECRET||"your-secret-key",{expiresIn:"30d"}),{password:I,...O}=d;return delete O.emailVerificationToken,delete O.emailVerificationExpires,n.Z.json({success:!0,user:O,token:F,message:"Kayıt başarılı! E-posta adresinize g\xf6nderilen doğrulama linkine tıklayarak hesabınızı aktifleştirin.",verificationCode:U})}catch(r){console.error("Register error:",r);let e="Bir hata oluştu";return r?.code==="P2002"?e="Bu e-posta adresi zaten kullanılıyor":r?.message?.includes("DATABASE_URL")?e="Veritabanı bağlantı hatası. L\xfctfen daha sonra tekrar deneyin.":r?.message&&(e=r.message),n.Z.json({success:!1,error:e},{status:500})}}let H=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\Users\\aslan\\Desktop\\masa\xfcst\xfc-10.25\\DIY_battery\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:F,staticGenerationAsyncStorage:I,serverHooks:O,headerHooks:V,staticGenerationBailout:$}=H,K="/api/auth/register/route";function L(){return(0,o.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:I})}},39145:(e,r,t)=>{t.d(r,{ED:()=>l,KX:()=>n});var s=t(68140),a=t(2532);t(40002);let i=null,o=()=>{if(i)return i;let e={host:process.env.SMTP_HOST||"smtp.hostinger.com",port:parseInt(process.env.SMTP_PORT||"465"),secure:"false"!==process.env.SMTP_SECURE,auth:{user:process.env.SMTP_USER||process.env.SMTP_EMAIL,pass:process.env.SMTP_PASSWORD},tls:{rejectUnauthorized:"false"!==process.env.SMTP_TLS_REJECT_UNAUTHORIZED,ciphers:"SSLv3"},pool:!0,maxConnections:5,maxMessages:100,connectionTimeout:1e4,greetingTimeout:1e4,socketTimeout:1e4,retry:{attempts:3,delay:2e3}};return i=s.createTransport(e)};async function n(e,r,t){if(!process.env.SMTP_USER||!process.env.SMTP_PASSWORD)return console.warn("SMTP credentials not set, skipping email send"),{success:!1,error:"SMTP not configured"};let s=Date.now();try{let i;let n=o();i="string"==typeof t?t:await Promise.race([(0,a.sY)(t),new Promise((e,r)=>setTimeout(()=>r(Error("Email render timeout")),5e3))]);let l=n.sendMail({from:process.env.SMTP_FROM||`"Batarya Kit" <${process.env.SMTP_USER}>`,to:e,subject:r,html:i,text:i.replace(/<[^>]*>/g,"").substring(0,500)}),u=await Promise.race([l,new Promise((e,r)=>setTimeout(()=>r(Error("SMTP send timeout")),3e4))]),c=Date.now()-s;return console.log(`Email sent in ${c}ms:`,u.messageId),{success:!0,data:{id:u.messageId,response:u.response,duration:`${c}ms`}}}catch(t){let e=Date.now()-s;console.error(`SMTP email send error (${e}ms):`,t);let r="Failed to send email";return t instanceof Error&&(r=t.message.includes("timeout")?"Email send timeout - SMTP server may be slow or unreachable":t.message.includes("authentication")?"SMTP authentication failed - check username and password":t.message.includes("connection")?"SMTP connection failed - check host and port":t.message),{success:!1,error:r}}}async function l(){try{let e=o();return await e.verify(),console.log("SMTP connection verified"),!0}catch(e){return console.error("SMTP verification failed:",e),!1}}},3214:(e,r,t)=>{t.d(r,{_:()=>a});var s=t(53524);let a=globalThis.prisma??new s.PrismaClient({log:["error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,4730,6082,7529,6878],()=>t(13436));module.exports=s})();