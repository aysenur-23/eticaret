"use strict";(()=>{var e={};e.id=6939,e.ids=[6939],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},22028:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>g,originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>d});var i={};a.r(i),a.d(i,{POST:()=>c});var n=a(95419),r=a(69108),s=a(99678),o=a(78070),u=a(3214);async function c(e){try{let{cellId:t,bmsId:a,chargerId:i,connectorId:n,caseId:r,ns:s,np:c,accessories:m}=await e.json();if(!t||!a||!i||!n||!s||!c)return o.Z.json({error:"Gerekli alanlar eksik"},{status:400});let[l,p,h,g,d]=await Promise.all([u._.cell.findUnique({where:{id:t}}),u._.bMS.findUnique({where:{id:a}}),u._.charger.findUnique({where:{id:i}}),u._.connector.findUnique({where:{id:n}}),r?u._.case.findUnique({where:{id:r}}):null]);if(!l||!p||!h||!g)return o.Z.json({error:"Bileşen bulunamadı"},{status:404});let y=function(e,t,a,i){let n=3.65*t,r=2.8*a,s=21060*t*a,o=i?i.width_mm:10*Math.ceil(Math.sqrt(s/100)),u=i?i.height_mm:10*Math.ceil(Math.sqrt(s/100)),c=i?i.length_mm:Math.ceil(s/(o*u));return{vnom:n,ah:r,wh:n*r,ns:t,np:a,iAvailable:2.8*a,iPeakAvailable:4*a,weight:t*a*45+(i?500:0),dimensions:{width:o,height:u,length:c}}}(0,s,c,d?{...d,ipRating:d.ipRating||void 0,mountInfo:d.mountInfo||void 0}:void 0),f=function(e,t,a){let i=[{awg:8,resistance:2.1,maxCurrent:40},{awg:10,resistance:3.3,maxCurrent:30},{awg:12,resistance:5.2,maxCurrent:20},{awg:14,resistance:8.3,maxCurrent:15},{awg:16,resistance:13.2,maxCurrent:10},{awg:18,resistance:21,maxCurrent:7},{awg:20,resistance:33.4,maxCurrent:5}],n=i.find(t=>t.maxCurrent>=e)||i[i.length-1],r=1*n.resistance;return{awg:n.awg,resistance:r,voltageDrop:e*r/1e3,maxCurrent:n.maxCurrent}}(y.iAvailable,0,y.vnom),A=function(e,t,a,i,n=25){let r=t.internalRmOhm*a/i/1e3*Math.pow(e,2),s=.5*r;return{powerLoss:r,temperatureRise:s,warning:s>20||n+s>60}}(y.iAvailable,l,s,c),w=function(e,t,a){let i=[],n=Math.abs(e.outV-t.vnom)<.05*t.vnom;n||i.push(`Voltaj uyumsuzluğu: ${e.outV}V vs ${t.vnom}V`);let r=e.outA<=t.np*a.maxChargeA;r||i.push(`Akım uyumsuzluğu: ${e.outA}A vs ${t.np*a.maxChargeA}A`);let s=t.ah/e.outA;return{compatible:n&&r,chargeTime:s,efficiency:e.efficiency||.85,warnings:i}}(h,y,l),C=s*c*15,v=d?30:0,x=m?10*m.length:0,k={summary:{totalCost:C+50+80+20+v+x,batterySpecs:y,cableSpecs:f,thermalSpecs:A,chargerSpecs:w},items:[{category:"H\xfccreler",items:[{name:l.name,quantity:s*c,unitCost:15,totalCost:C,specifications:{chemistry:l.chemistry,nominalV:l.nominalV,capacityAh:l.capacityAh,weight_g:l.weight_g}}]},{category:"BMS",items:[{name:p.name,quantity:1,unitCost:50,totalCost:50,specifications:{seriesRange:`${p.seriesMin}-${p.seriesMax}S`,contA:p.contA,peakA:p.peakA,chemistry:p.chemistry}}]},{category:"Şarj Cihazı",items:[{name:h.name,quantity:1,unitCost:80,totalCost:80,specifications:{outV:h.outV,outA:h.outA,profile:h.profile,efficiency:h.efficiency}}]},{category:"Konekt\xf6rler",items:[{name:g.name,quantity:1,unitCost:20,totalCost:20,specifications:{type:g.type,contA:g.contA,peakA:g.peakA,antiSpark:g.antiSpark}}]}]};if(d&&k.items.push({category:"Kutu",items:[{name:d.name,quantity:1,unitCost:30,totalCost:v,specifications:{chemistry:"N/A",nominalV:0,capacityAh:0,weight_g:0}}]}),m&&m.length>0){let e=await u._.accessory.findMany({where:{id:{in:m}}});k.items.push({category:"Aksesuarlar",items:e.map(e=>({name:e.name,quantity:1,unitCost:10,totalCost:10,specifications:{chemistry:"N/A",nominalV:0,capacityAh:0,weight_g:0}}))})}return o.Z.json({success:!0,data:k})}catch(e){return console.error("BOM generation error:",e),o.Z.json({error:"Sunucu hatası"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/bom/route",pathname:"/api/bom",filename:"route",bundlePath:"app/api/bom/route"},resolvedPagePath:"C:\\Users\\aslan\\Desktop\\masa\xfcst\xfc-10.25\\DIY_battery\\app\\api\\bom\\route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:h,headerHooks:g,staticGenerationBailout:d}=m,y="/api/bom/route";function f(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}},3214:(e,t,a)=>{a.d(t,{_:()=>n});var i=a(53524);let n=globalThis.prisma??new i.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[1638,6206],()=>a(22028));module.exports=i})();