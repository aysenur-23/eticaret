"use strict";(()=>{var r={};r.id=6453,r.ids=[6453],r.modules={53524:r=>{r.exports=require("@prisma/client")},30517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:r=>{r.exports=require("buffer")},6113:r=>{r.exports=require("crypto")},12781:r=>{r.exports=require("stream")},73837:r=>{r.exports=require("util")},34067:(r,e,t)=>{t.r(e),t.d(e,{headerHooks:()=>j,originalPathname:()=>q,patchFetch:()=>g,requestAsyncStorage:()=>y,routeModule:()=>v,serverHooks:()=>w,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>Z});var a={};t.r(a),t.d(a,{DELETE:()=>h,GET:()=>p,POST:()=>m,PUT:()=>f});var n=t(95419),i=t(69108),o=t(99678),s=t(78070),u=t(3214),c=t(46082),d=t.n(c);function l(r){let e=r.headers.get("authorization"),t=e?.replace("Bearer ","");if(!t)return null;try{return d().verify(t,process.env.JWT_SECRET||"your-secret-key").userId}catch{return null}}async function p(r){try{let e=l(r);if(!e)return s.Z.json({error:"Unauthorized"},{status:401});let t=await u._.cart.findUnique({where:{userId:e},include:{items:{include:{variant:{include:{product:!0}}}}}});if(!t)return s.Z.json({items:[],total:0});let a=t.items.map(r=>({id:r.id,name:r.variant.product.name,description:r.variant.product.description,price:r.unitPrice,quantity:r.quantity,image:r.variant.product.image||r.variant.product.images?.[0],category:r.variant.product.category?.name,variantId:r.variantId,productId:r.variant.productId})),n=a.reduce((r,e)=>r+e.price*e.quantity,0);return s.Z.json({items:a,total:n})}catch(r){return console.error("Cart GET error:",r),s.Z.json({error:"Internal server error"},{status:500})}}async function m(r){try{let e=l(r);if(!e)return s.Z.json({error:"Unauthorized"},{status:401});let{items:t}=await r.json();if(!Array.isArray(t))return s.Z.json({error:"Invalid input"},{status:400});let a=await u._.cart.findUnique({where:{userId:e}});for(let r of(a||(a=await u._.cart.create({data:{userId:e}})),await u._.cartItem.deleteMany({where:{cartId:a.id}}),t))await u._.cartItem.create({data:{cartId:a.id,variantId:r.id,quantity:r.quantity,unitPrice:r.price,vatRate:.2}});return s.Z.json({success:!0})}catch(r){return console.error("Cart POST error:",r),s.Z.json({error:"Internal server error"},{status:500})}}async function f(r){try{if(!l(r))return s.Z.json({error:"Unauthorized"},{status:401});let{itemId:e,quantity:t}=await r.json();if(!e||void 0===t)return s.Z.json({error:"Invalid input"},{status:400});return t<=0?await u._.cartItem.delete({where:{id:e}}):await u._.cartItem.update({where:{id:e},data:{quantity:t}}),s.Z.json({success:!0})}catch(r){return console.error("Cart PUT error:",r),s.Z.json({error:"Internal server error"},{status:500})}}async function h(r){try{let e=l(r);if(!e)return s.Z.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(r.url),a=t.get("itemId");if(!a)return s.Z.json({error:"Item ID required"},{status:400});let n=await u._.cart.findUnique({where:{userId:e}});if(!n)return s.Z.json({error:"Cart not found"},{status:404});if(!await u._.cartItem.findFirst({where:{id:a,cartId:n.id}}))return s.Z.json({error:"Item not found"},{status:404});return await u._.cartItem.delete({where:{id:a}}),s.Z.json({success:!0})}catch(r){return console.error("Cart DELETE error:",r),s.Z.json({error:"Internal server error"},{status:500})}}let v=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/cart/route",pathname:"/api/cart",filename:"route",bundlePath:"app/api/cart/route"},resolvedPagePath:"C:\\Users\\aslan\\Desktop\\masa\xfcst\xfc-10.25\\DIY_battery\\app\\api\\cart\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:I,serverHooks:w,headerHooks:j,staticGenerationBailout:Z}=v,q="/api/cart/route";function g(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:I})}},3214:(r,e,t)=>{t.d(e,{_:()=>n});var a=t(53524);let n=globalThis.prisma??new a.PrismaClient({log:["error"]})}};var e=require("../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),a=e.X(0,[1638,6206,6082],()=>t(34067));module.exports=a})();