"use strict";(()=>{var e={};e.id=3615,e.ids=[3615],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},10768:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>j,patchFetch:()=>x,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>m,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>y});var s={};t.r(s),t.d(s,{GET:()=>p,POST:()=>v,generateStaticParams:()=>c});var a=t(95419),i=t(69108),n=t(99678),u=t(78070),o=t(3214),d=t(46082),l=t.n(d);function c(){return[]}async function p(e,{params:r}){try{let e=await o._.review.findMany({where:{productId:r.id,status:"approved"},include:{user:{select:{id:!0,name:!0,email:!1}}},orderBy:{createdAt:"desc"}}),t=e.length>0?e.reduce((e,r)=>e+r.rating,0)/e.length:0;return u.Z.json({reviews:e,averageRating:Math.round(10*t)/10,totalReviews:e.length})}catch(e){return console.error("Reviews GET error:",e),u.Z.json({error:"Internal server error"},{status:500})}}async function v(e,{params:r}){try{let t=function(e){let r=e.headers.get("authorization"),t=r?.replace("Bearer ","");if(!t)return null;try{return l().verify(t,process.env.JWT_SECRET||"your-secret-key").userId}catch{return null}}(e);if(!t)return u.Z.json({success:!1,error:"Giriş yapmanız gerekiyor"},{status:401});let{rating:s,title:a,comment:i,images:n}=await e.json();if(!s||!i)return u.Z.json({success:!1,error:"Yıldız ve yorum gereklidir"},{status:400});if(s<1||s>5)return u.Z.json({success:!1,error:"Yıldız 1-5 arası olmalıdır"},{status:400});let d=await o._.review.findFirst({where:{productId:r.id,userId:t}});if(d){let e=await o._.review.update({where:{id:d.id},data:{rating:parseInt(s),title:a||null,comment:i,images:n||null,status:"pending"}});return u.Z.json({success:!0,review:e},{status:200})}let c=await o._.review.create({data:{productId:r.id,userId:t,rating:parseInt(s),title:a||null,comment:i,images:n||null,status:"approved"}});return u.Z.json({success:!0,review:c},{status:201})}catch(e){return console.error("Review POST error:",e),u.Z.json({success:!1,error:"Bir hata oluştu"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/products/[id]/reviews/route",pathname:"/api/products/[id]/reviews",filename:"route",bundlePath:"app/api/products/[id]/reviews/route"},resolvedPagePath:"C:\\Users\\aslan\\Desktop\\masa\xfcst\xfc-10.25\\DIY_battery\\app\\api\\products\\[id]\\reviews\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:w,serverHooks:m,headerHooks:f,staticGenerationBailout:y}=g,j="/api/products/[id]/reviews/route";function x(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:w})}},3214:(e,r,t)=>{t.d(r,{_:()=>a});var s=t(53524);let a=globalThis.prisma??new s.PrismaClient({log:["error"]})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,6082],()=>t(10768));module.exports=s})();