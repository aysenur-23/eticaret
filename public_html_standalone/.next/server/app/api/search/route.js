"use strict";(()=>{var e={};e.id=280,e.ids=[280],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35325:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>m,originalPathname:()=>y,patchFetch:()=>k,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>f});var r={};i.r(r),i.d(r,{GET:()=>u});var a=i(95419),s=i(69108),n=i(99678),c=i(78070),o=i(3214);class p{constructor(e){this.prisma=e}async search(e,t=1,i=24){let r={active:!0};if(e.categoryId&&(r.categoryId=e.categoryId),(void 0!==e.priceMin||void 0!==e.priceMax)&&(r.variants={some:{isActive:!0,price:{...void 0!==e.priceMin&&{gte:e.priceMin},...void 0!==e.priceMax&&{lte:e.priceMax}}}}),e.lifecycle&&e.lifecycle.length>0&&(r.lifecycle={in:e.lifecycle}),void 0!==e.featured&&(r.isFeatured=e.featured),void 0!==e.inStock&&(r.stock={some:{onHand:e.inStock?{gt:0}:{lte:0}}}),e.query&&(r.OR=[{name:{contains:e.query,mode:"insensitive"}},{nameEn:{contains:e.query,mode:"insensitive"}},{description:{contains:e.query,mode:"insensitive"}},{mpn:{contains:e.query,mode:"insensitive"}},{sku:{contains:e.query,mode:"insensitive"}},{specs:{path:["$"],string_contains:e.query}}]),e.specs&&Object.keys(e.specs).length>0){let t=[];for(let[i,r]of Object.entries(e.specs))if(void 0!==r.min||void 0!==r.max){let e=`$.${i}`;void 0!==r.min&&t.push({specs:{path:[e],gte:r.min}}),void 0!==r.max&&t.push({specs:{path:[e],lte:r.max}})}else void 0!==r.value&&t.push({specs:{path:[`$.${i}`],equals:r.value}});t.length>0&&(r.AND=(r.AND||[]).concat(t))}if(e.certifications&&Object.keys(e.certifications).length>0){let t=[];for(let[i,r]of Object.entries(e.certifications))t.push({certifications:{path:[`$.${i}`],equals:r}});t.length>0&&(r.AND=(r.AND||[]).concat(t))}let[a,s]=await Promise.all([this.prisma.product.findMany({where:r,include:{category:!0,variants:{where:{isActive:!0},include:{stock:!0}},stock:!0},skip:(t-1)*i,take:i,orderBy:e.featured?{isFeatured:"desc"}:{createdAt:"desc"}}),this.prisma.product.count({where:r})]);return{products:a,total:s}}async getFacets(e){return{}}}let l=new p(o._);async function u(e){try{let{searchParams:t}=new URL(e.url),i={query:t.get("q")||void 0,categoryId:t.get("category")||void 0,priceMin:t.get("priceMin")?parseFloat(t.get("priceMin")):void 0,priceMax:t.get("priceMax")?parseFloat(t.get("priceMax")):void 0,lifecycle:t.get("lifecycle")?.split(",")||void 0,inStock:"true"===t.get("inStock")||void 0,featured:"true"===t.get("featured")||void 0,specs:function(e){let t={};return e.forEach((e,i)=>{if(i.endsWith("_min")){let r=i.replace("_min","");t[r]||(t[r]={}),t[r].min=parseFloat(e)}else if(i.endsWith("_max")){let r=i.replace("_max","");t[r]||(t[r]={}),t[r].max=parseFloat(e)}else i.startsWith("spec_")&&(t[i.replace("spec_","")]={value:e})}),Object.keys(t).length>0?t:void 0}(t),certifications:function(e){let t={};return["rohs","reach","ce","ip"].forEach(i=>{"true"===e.get(i)&&(t[i]=!0)}),Object.keys(t).length>0?t:void 0}(t)},r=parseInt(t.get("page")||"1"),a=t.get("limit"),s=a?parseInt(a):parseInt(t.get("pageSize")||"24"),n=await l.search(i,r,s);return c.Z.json(n)}catch(e){return console.error("Search error:",e),c.Z.json({error:"Internal server error"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"C:\\Users\\aslan\\Desktop\\masa\xfcst\xfc-10.25\\DIY_battery\\app\\api\\search\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:v,serverHooks:g,headerHooks:m,staticGenerationBailout:f}=d,y="/api/search/route";function k(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:v})}},3214:(e,t,i)=>{i.d(t,{_:()=>a});var r=i(53524);let a=globalThis.prisma??new r.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[1638,6206],()=>i(35325));module.exports=r})();