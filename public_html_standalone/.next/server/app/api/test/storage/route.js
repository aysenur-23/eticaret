"use strict";(()=>{var e={};e.id=7881,e.ids=[7881],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},71017:e=>{e.exports=require("path")},37752:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>_,originalPathname:()=>j,patchFetch:()=>U,requestAsyncStorage:()=>E,routeModule:()=>v,serverHooks:()=>A,staticGenerationAsyncStorage:()=>S,staticGenerationBailout:()=>b});var o={};r.r(o),r.d(o,{GET:()=>y,POST:()=>D});var a=r(95419),s=r(69108),n=r(99678),i=r(78070);let l=require("fs/promises");var c=r.n(l),u=r(71017),p=r.n(u);let d=process.env.UPLOAD_BASE_DIR||p().join(process.cwd(),"public","uploads"),h=new Set;async function w(e=""){let t=e?p().join(d,e):d;if(!h.has(t))try{try{if((await c().stat(t)).isDirectory()){h.add(t);return}}catch{}await c().mkdir(t,{recursive:!0,mode:493}),h.add(t)}catch(e){throw console.error("Failed to create upload directory:",e),Error(`Failed to create upload directory: ${t}`)}}async function f(e,t,r,o){let a=Date.now();try{if(t.length>52428800)throw Error("File size exceeds maximum allowed size of 50MB");let o=p().basename(r).replace(/[^a-zA-Z0-9._-]/g,"_");if(!o||0===o.length)throw Error("Invalid file name");await w(e);let s=Date.now(),n=Math.random().toString(36).substring(2,8),i=p().extname(o)||".bin",l=p().basename(o,i),u=`${l}-${s}-${n}${i}`,h=p().join(d,e,u),f=`${h}.tmp`;try{await c().writeFile(f,t,{mode:420}),await c().rename(f,h)}catch(e){try{await c().unlink(f)}catch{}throw e}let m=Date.now()-a;console.log(`File uploaded in ${m}ms: ${u} (${(t.length/1024).toFixed(2)}KB)`);let g=p().join("uploads",e,u).replace(/\\/g,"/");return`http://localhost:3000/${g}`}catch(t){let e=Date.now()-a;throw console.error(`File upload error (${e}ms):`,t),t instanceof Error?t:Error("Failed to upload file")}}async function m(e){try{let t=new URL(e).pathname,r=t.startsWith("/")?t.slice(1):t;if(!r.startsWith("uploads/"))return console.error("Invalid file path for deletion:",r),!1;let o=process.env.UPLOAD_BASE_DIR||p().join(process.cwd(),"public"),a=p().join(o,r);return await c().unlink(a),!0}catch(e){return console.error("File delete error:",e),!1}}async function g(e){try{let t=new URL(e).pathname,r=t.startsWith("/")?t.slice(1):t;if(!r.startsWith("uploads/"))return 0;let o=process.env.UPLOAD_BASE_DIR||p().join(process.cwd(),"public"),a=p().join(o,r);return(await c().stat(a)).size}catch(e){return console.error("Get file size error:",e),0}}async function y(e){try{let e=process.env.UPLOAD_BASE_DIR||p().join(process.cwd(),"public","uploads"),t=!1,r=!1;try{await c().access(e),t=!0;let o=p().join(e,".test-write");await c().writeFile(o,"test"),await c().unlink(o),r=!0}catch(e){}let o=process.env.UPLOAD_BASE_DIR?"Hostinger File System":process.env.STORAGE_BUCKET?"S3-Compatible":"Default (public/uploads)";return i.Z.json({storage:{type:o,baseDir:e,publicUrl:"http://localhost:3000",dirExists:t,dirWritable:r,configured:!!(process.env.UPLOAD_BASE_DIR||process.env.STORAGE_BUCKET)}})}catch(e){return console.error("Storage test error:",e),i.Z.json({error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function D(e){try{let e=Buffer.from("Test file content - "+new Date().toISOString()),t=`test-${Date.now()}.txt`,r=await f("products",e,t,"text/plain"),o=await g(r);return await m(r),i.Z.json({success:!0,message:"Storage test successful",data:{uploaded:r,size:o,deleted:!0}})}catch(e){return console.error("Storage upload test error:",e),i.Z.json({error:e instanceof Error?e.message:"Unknown error"},{status:500})}}let v=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/test/storage/route",pathname:"/api/test/storage",filename:"route",bundlePath:"app/api/test/storage/route"},resolvedPagePath:"C:\\Users\\aslan\\Desktop\\masa\xfcst\xfc-10.25\\DIY_battery\\app\\api\\test\\storage\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:E,staticGenerationAsyncStorage:S,serverHooks:A,headerHooks:_,staticGenerationBailout:b}=v,j="/api/test/storage/route";function U(){return(0,n.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:S})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[1638,6206],()=>r(37752));module.exports=o})();